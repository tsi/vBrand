function amzn_ads(data){"use strict";try{amznads.updateAds(data)}catch(e){try{console.log("amzn_ads: "+e)}catch(ignore){}}}function aax_render_ad(ad){var html=ad.html;document.write(html)}var amzn_console=function(){"use strict";var my={};my.log=function(){};return my}();if(window.console){amzn_console=window.console}var amznads=function(my,document,window,console){"use strict";var useSSL="https:"===document.location.protocol;my.protocol=useSSL?"https://":"http://";my.host="aax.amazon-adsystem.com";my.dtb_svc="/e/dtb/bid";my.pb_svc="/x/getad";my.debug_mode=my.debug_mode||false;my.MIN_TIMEOUT=0;my.DEFAULT_TIMEOUT=1e3;my.targetingKey="amznslots";my.tasks=my.tasks||[];my.log=function(msg){try{console.log(msg)}catch(ignore){}};if(my.debug_mode){my.log("Initiating amznads")}if(!my.ads){my.ads={}}my.updateAds=function(data){my.ads=data.ads;if(my.debug_mode){my.log("Updated ads. Executing rest of the task queue")}my.doAllTasks();my.tasks.push=function(task){my.doTask(task)}};my.saveAds=function(data){my.saved_ads=data.ads;my.updateAds(data)};my.getAdForSlot=function(sourceId,slotUuid,async){my.src_id=sourceId;var data=data||{};var url=data.u;if(!url){url=encodeURIComponent(document.documentURI);try{url=encodeURIComponent(window.top.location.href)}catch(ignore){}}if(url&&url.indexOf("amzn_debug_mode")!==-1){my.debug_mode=true}if(my.debug_mode){my.log("amznads.getAdForSlot: Using url="+url)}var params="src="+my.src_id+"&slot_uuid="+slotUuid+"&c=100"+"&u="+url+"&cb="+Math.round(Math.random()*1e7);var script_src=my.protocol+my.host+my.pb_svc+"?"+params;if(my.debug_mode){my.log("amznads.getAdAdForSlot: "+(async?"Async ":"")+"Call to: "+script_src)}if(async){my.appendScriptTag(script_src)}else{document.write("<script type='text/javascript' src='"+script_src+"'></script>");document.close()}};my.getAdsCallback=function(id,callbackFn,timeout,size,data){var _callback=null;var data=data||{};try{if(callbackFn&&typeof callbackFn==="function"){_callback=my.handleCallBack(callbackFn,timeout)}}catch(e){if(my.debug_mode){my.log("amznads.getAdsAsyncWithCallback(): Error occured in setting up callback functionality."+e)}}if(!data.to){data.to=timeout}my.doGetAdsAsync(id,size,data,_callback)};my.getAdsAsync=function(id,size,data){my.doGetAdsAsync(id,size,data)};my.handleCallBack=function(callbackFn,timeout){var isCallBackFnExecuted=false;var _timerHandle=null;var _callbackWrapper=function(fromOnload){if(!isCallBackFnExecuted){try{callbackFn(fromOnload);if(_timerHandle){clearTimeout(_timerHandle)}}catch(ignore){}isCallBackFnExecuted=true}};var validTimeout=my.getValidMilliseconds(timeout);if(validTimeout){_timerHandle=window.setTimeout(_callbackWrapper,validTimeout)}else{_timerHandle=window.setTimeout(_callbackWrapper,my.DEFAULT_TIMEOUT)}return _callbackWrapper};my.getValidMilliseconds=function(timeout){if(!timeout){return false}try{var miliseconds=~~Number(timeout);if(miliseconds>my.MIN_TIMEOUT){return miliseconds}}catch(e){if(my.debug_mode){my.log("amznads.isValidMilliseconds(): Invalid timeout specified."+e)}return false}return false};my.getAds=function(id,size,data,async){if(async){my.doGetAdsAsync(id,size,data);return}else{var script_src=my.getScriptSource(id,size,data);if(my.debug_mode){my.log("amznads.getAds: Call to: "+script_src)}document.write("<script type='text/javascript' src='"+script_src+"'></script>");document.close()}};my.doGetAdsAsync=function(id,size,data,callbackFn){var script_src=my.getScriptSource(id,size,data);if(my.debug_mode){my.log("amznads.getAds: Async Call to: "+script_src)}my.appendScriptTag(script_src,callbackFn)};my.getScriptSource=function(id,size,data){my.src_id=id;var data=data||{};var url=data.u;var domain=data.d;var timeout=data.to;if(!url){url=encodeURIComponent(document.documentURI);try{url=encodeURIComponent(window.top.location.href)}catch(ignore){}}if(url&&url.indexOf("amzn_debug_mode")!==-1){my.debug_mode=true}if(my.ads){if(my.debug_mode){my.log("amznads.getAds(): clear out existing ads")}my.clearTargetingFromGPTAsync();my.ads={}}if(my.saved_ads){my.ads=my.saved_ads}if(domain){try{document.domain=domain;if(my.debug_mode){my.log("amznads.getAds(): Using domain="+domain)}}catch(e){if(my.debug_mode){my.log("amznads.getAds(): Unable to override document domain with '"+domain+"'; exception="+e)}}}if(my.debug_mode){my.log("amznads.getAds(): Using url="+url)}var params="src="+id+"&u="+url+"&cb="+Math.round(Math.random()*1e7);if(size){params+="&sz="+size}if(timeout){params+="&t="+timeout}var script_src=my.protocol+my.host+my.dtb_svc+"?"+params;return script_src};my.appendScriptTag=function(script_src,callbackFn){var insertLoc=document.getElementsByTagName("script")[0];var s=document.createElement("script");s.type="text/javascript";s.async=true;s.src=script_src;try{if(callbackFn&&typeof callbackFn==="function"){if(s.readyState){s.onreadystatechange=function(){if(s.readyState=="loaded"||s.readyState=="complete"){s.onreadystatechange=null;callbackFn(true)}};if(my.debug_mode){my.log("amznads.appendScriptTag: setting callBack function for < IE-8 ")}}else{s.onload=function(){callbackFn(true)};if(my.debug_mode){my.log("amznads.appendScriptTag: setting callBack function for all other browsers exluding  < IE-8")}}}}catch(e){if(my.debug_mode){my.log("amznads.appendScriptTag: Could not associate callBack function; "+e)}}insertLoc.parentNode.insertBefore(s,insertLoc)};my.renderAd=function(doc,key){if(my.debug_mode){my.log("amznads.renderAd: key="+key+"; ad-tag="+my.ads[key])}if(my.ads[key]){doc.write(my.ads[key]);doc.close()}else{var errorJSON=new Object;errorJSON.c="dtb";errorJSON.src=my.src_id;errorJSON.kvmismatch=1;errorJSON.pubReturnedKey=key;errorJSON.aaxReturnedKeys=my.getTokens();errorJSON.cb=Math.round(Math.random()*1e7);try{errorJSON.u=encodeURIComponent(location.host+location.pathname);if(navigator){errorJSON.ua=encodeURIComponent(navigator.userAgent)}}catch(e){}var urlEncodedJSON=encodeURIComponent(JSON.stringify(errorJSON));var img_src=my.protocol+my.host+"/x/px/p/0/"+urlEncodedJSON;if(my.debug_mode){my.log("amznads.renderAd: keyValueMismatch detected, "+"pubReturnedKey="+key+", aaxReturnedKeys="+my.getTokens())}doc.write("<img src='"+img_src+"'/>");doc.close()}};my.hasAds=function(size){var k;if(!size){try{return Object.keys(my.ads).length>0}catch(e){if(my.debug_mode){my.log("amznads.hasAds: looks like IE 8 (and below): "+e)}for(k in my.ads){if(my.ads.hasOwnProperty(k)){return true}}}}for(k in my.ads){if(my.ads.hasOwnProperty(k)){if(k.indexOf(size)>0){return true}}}return false};my.setTargeting=function(func,size){var k;for(k in my.ads){if(my.ads.hasOwnProperty(k)){if(size&&k.indexOf(size)<0){continue}func(k,"1")}}};my.setTargetingForGPTAsync=function(keyName){try{if(keyName){my.targetingKey=keyName;var tokens=my.getTokens();if(typeof tokens!="undefined"&&tokens.length>0){googletag.cmd.push(function(){googletag.pubads().setTargeting(keyName,tokens)})}}else{var k;for(k in my.ads){if(my.ads.hasOwnProperty(k)){(function(){var localKey=k;if(my.debug_mode){my.log("amznads.setTargetingForGPTAsync: pushing localKey="+localKey)}googletag.cmd.push(function(){if(amznads.debug_mode){amznads.log("amznads.setTargetingForGPTAsync: localKey="+localKey)}googletag.pubads().setTargeting(localKey,"1")})})()}}}if(my.debug_mode){my.log("amznads.setTargetingForGPTAsync: Completed successfully. Number of ads returned by Amazon: "+Object.keys(my.ads).length)}}catch(e){if(my.debug_mode){my.log("amznads.setTargetingForGPTAsync: ERROR - "+e)}}};my.setTargetingForGPTSync=function(keyName){try{if(keyName){my.targetingKey=keyName;var tokens=my.getTokens();if(typeof tokens!="undefined"&&tokens.length>0){googletag.pubads().setTargeting(keyName,tokens)}}else{var k;for(k in my.ads){if(my.ads.hasOwnProperty(k)){googletag.pubads().setTargeting(k,"1")}}}if(my.debug_mode){my.log("amznads.setTargetingForGPTSync: Completed successfully. Number of ads returned by Amazon: "+Object.keys(my.ads).length)}}catch(e){if(my.debug_mode){my.log("amznads.setTargetingForGPTSync: ERROR - "+e)}}};my.clearTargetingFromGPTAsync=function(){try{if(googletag&&googletag.pubads())googletag.pubads().clearTargeting(my.targetingKey)}catch(ignore){}};my.appendTargetingToAdServerUrl=function(url){var input_url=url;try{if(url.indexOf("?")===-1){url=url+"?"}var k;for(k in my.ads){if(my.ads.hasOwnProperty(k)){url+="&"+k+"=1"}}if(my.debug_mode){my.log("amznads.appendTargetingToAdServerUrl: Completed successfully. Number of ads returned by Amazon: "+my.ads.length)}}catch(e){if(my.debug_mode){my.log("amznads.appendTargetingToAdServerUrl: ERROR - "+e)}}if(my.debug_mode){my.log("amznads.appendTargetingToAdServerUrl: input url: "+input_url+"\nreturning url: "+url)}return url};my.appendTargetingToQueryString=function(q){var input_q=q;try{var k;for(k in my.ads){if(my.ads.hasOwnProperty(k)){q+="&"+k+"=1"}}}catch(e){if(my.debug_mode){my.log("amznads.appendTargetingToQueryString: ERROR - "+e)}}if(my.debug_mode){my.log("amznads.appendTargetingToQueryString: input query-string:"+input_q+"\nreturning query-string:"+q)}return q};my.getTokens=function(size){var k,tokens=[];try{for(k in my.ads){if(my.ads.hasOwnProperty(k)){if(size&&k.indexOf(size)<0){continue}tokens.push(k)}}}catch(e){if(my.debug_mode){my.log("amznads.getTokens: ERROR - "+e)}}if(my.debug_mode){my.log("amznads.getTokens: returning tokens = "+tokens)}return tokens};my.getKeys=my.getTokens;my.doAllTasks=function(){while(my.tasks.length>0){var task=my.tasks.shift();my.doTask(task)}};my.doTask=function(task){try{task.call()}catch(e){if(my.debug_mode){my.log("Failed calling task: "+e)}}};my.tryGetAdsAsync=function(){if(my.asyncParams){my.getAdsCallback(my.asyncParams.id,my.asyncParams.callbackFn,my.asyncParams.timeout,my.asyncParams.size,my.asyncParams.data)}};return my}(amznads||{},document,window,amzn_console);amznads.tryGetAdsAsync();window["amzn_ads"]=amzn_ads;window["amznads"]=amznads;